name: Node.js Discord Test

on:
  workflow_dispatch:
  schedule:
    - cron: "*/10 * * * *"   # 10분마다 (UTC 기준!)

permissions:
  contents: write   # ← state.json을 커밋/푸시하려면 필요

jobs:
  send-message:
    runs-on: ubuntu-latest
    env:
      DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      LUNLUN: ${{ vars.LUNLUN }}
      # 원하는 인스턴스 순서 (왼쪽부터 시도)
      NITTER_LIST: https://nitter.net,https://nitter.poast.org,https://n.opnxng.com,https://nitter.fdn.fr,https://nitter.privacydev.net
      DEBUG: "1"

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Node 20 & sanity
        uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: |
          node -v
          node -p "typeof fetch, typeof File"
          echo "HEAD: $GITHUB_SHA"
          head -n 5 index.js

      - name: Install deps
        run: npm ci || npm i

      - name: Run script
        run: node index.js